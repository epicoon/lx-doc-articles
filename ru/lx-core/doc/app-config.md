[Английская версия (English version)](https://github.com/epicoon/lx-doc-articles/en/lx-core/doc/app-config.md)

## Конфигурация приложения

### Оглавление
* [Общая информация](#common)
* [Пример конфигурации](#example)
* [mode](#mode)
* [packagesMap](#packagesMap)
* [aliases](#aliases)
* [router](#router)
* [language](#language)
* [configInjection](#configInjection)
* [jsBootstrap и jsMain](#js)
* [i18nFile](#i18nFile)


<a name="common"><h3>Общая информация</h3></a>
Кроме приложения конфигурационные файлы имеют сервисы и модули. Следующие утверждения справедливы для конфигурационных файлов как приложения, так и сервисов и модулей:
* Конфигурационные файлы могут быть в форматax: `yaml`, `php`, `json`.
* Если данные конфигурации нет смысла разносить по нескольких файлам, конфигурационный файл может быть один. Тогда он должен иметь имя `config.(yaml|php|json)`.
* Если данные конфигурации удобнее разнести по нескольким файлам, главный файл конфигурации должен иметь имя `main.(yaml|php|json)` и находиться в каталоге `config`.

В случае сервиса или модуля конфигурационный файл (или каталог с конфигурационными файлами) должен располагаться непосредственно в его каталоге.

Все служебные файлы, обеспечивающие работу платформы, находятся в каталоге `lx` в корне приложения. Там же должен находиться конфигурационный файл (или каталог с конфигурационными файлами) приложения. В случае отсутствия конфигурационного файла приложения, при вызове утилиты `lx-install`, он будет сгенерирован.


<a name="example"><h3>Пример конфигурации</h3></a>
Вариант в синтаксисе `yaml`
```yaml
mode: dev

packagesMap:
  - vendor
  - services

aliases:
  services: @site/services
  web: @site/web

router: ^ref routes.yaml

language: some\LanguageClassName

configInjection: ^ref injections.yaml

jsBootstrap @web/js/bootstrap.js
jsMain: @web/js/main.js
```


<a name="mode"><h3>Параметр конфигурации: <b>mode</b></h3></a>
Текстовая метка режима работы приложения.<br>
В зависимости от режима можно выполнять определенный код на стороне сервера, пример:
```php
if (\lx::isMode('dev')) {
	// ... code
}
```
В зависимости от режима можно помечать код, который будет предоставлен клиенту, пример:
```js
#lx:mode-case: dev;
	// Код, который попадет на сторону клиента только при режиме работы приложения 'dev'
#lx:mode-case: prod;
	// Код, который попадет на сторону клиента только при режиме работы приложения 'prod'
#lx:mode-end;
```


<a name="packagesMap"><h3>Параметр конфигурации: <b>packagesMap</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется массив путей к каталогам пакетов относительно корневого каталога приложения. Поскольку большая часть кода приложения огранизуется в виде сервисов (пакеты с особыми возможностями), удобно иметь несколько каталогов с пакетами, как минимум два:
* для зависимостей приложения (композер-пакетов, традиционно каталог `vendor`). Этот каталог не должен отслеживаться системой контроля версий
* для пакетов (и сервисов в частности), разрабатываемых в рамках приложения. Этот каталог должен отслеживаться системой контроля версий
Пример:
```yaml
packagesMap:
  - vendor    # здесь будут располагаться зависимости приложения
  - services  # здесь разместим пакеты самого приложения
```


<a name="aliases"><h3>Параметр конфигурации: <b>aliases</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется ассоциативный массив, ключами которого являются псевдонимы для путей в системе каталогов приложения, а значениями - сами пути. Пример:
```yaml
aliases:
  # Псевдонимы для путей относительно корня сайта
  vendor: /vendor
  web: /web

  # Псевдоним, объявленный через другой псевдоним
  dataForWeb: @web/data

  # Можно даже так - относительно каталога сервиса
  serviceNameSomeDir: {service:some/service-name}/some-dir
```
Примеры использования псевдонимов:
```php
// Код PHP

// Получение файла
$file = new lx\File('@web/path/to/file');

// То же самое с использованием компонента conductor
$web = \lx::$conductor->web;
$file = new lx\File($web . '/path/to/file');
```
```js
// Код JS

// Загрузка содержимого файла в коде JS
const someData = #lx:load @web/path/to/file;
```
Если псевдонимы, уже встроенные в платформу, т.е. они сразу доступны как поля компонента `conductor`, и их можно использовать в указаниях путей, предваряя символом `@`:
* site - путь к корневому каталогу проекта
* lxFiles - путь к каталогу `lx`, располагающемуся в корне проекта. Этот каталог содержит файлы, необходимые для функционирования платформы 
* lxData - путь к каталогу `lx/data` относительно корня проекта. Этот каталог содержит данные для работы платформы, которые могут быть изменяемыми.


<a name="router"><h3>Параметр конфигурации: <b>router</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется ассоциативный масив, содержащий информацию о роутере приложения. Обязательно должен содержать элемент с ключом `type`, с одним из двух значений:
* `map` - в этом случае требуется поясняющий параметр `routes` - карта роутинга, либо параметр `path` - где лежит карта. Карта представляет из себя ассоциативный массив, где ключ - URL запроса (или регулярное выражение), значение - данные об объекте, куда перенаправляется запрос.
* `class` - в этом случае требуется поясняющий параметр `name` - имя класса, отнаследованного от `lx\Router`
Пример:
```yaml
router:
  type: map
  routes:
    # Перенаправление домашней страницы на определенный сервис
    /: my/home-service

    # Если ключ начинается на '~', это регулярное выражение
    # все подходящие запросы перенаправятся на указанный сервис
    ~^admin\b: my/admin
```
Подробнее о формате карты можно узнать по [ссылке](https://github.com/epicoon/lx-doc-articles/ru/lx-core/doc/routing.md).


<a name="language"><h3>Параметр конфигурации: <b>language</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется информация о классе языка, который нужно использовать в приложении. Если параметр не конфигурирован, используется стандартный `lx\Language`.<br>
Указать информацию о классе можно несколькими способами:
```yaml
# Указание имени класса
language: ClassName

# Указание ассоциативного массива с именем класса и параметрами для его создания
language:
  class: ClassName
  param1: value1
  param2: value2

# Указание ассоциативного массива с именем класса
# и параметрами для его создания явно выделенными в отденый массив для наглядности
language:
  class: ClassName
  params:
    param1: value1
    param2: value2
```


<a name="configInjection"><h3>Параметр конфигурации: <b>configInjection</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется ассоциативный массив, ключами которого являются имена сервисов и модулей, а значениями - фрагменты конфигураций, которые нужно внежрить в соответсвующие сервисы и модули.<br>
Пример:
```yaml
configInjection:
  # Прокидываем в конфигурацию сервиса параметры
  lx/lx-dev-wizard:
    # Заменяем текущую карту интернационализации
    i18nMap: i18n\devWizard\Translater
```
Какие параметры имеются в конфигурации сервиса, можно узнать по [ссылке](https://github.com/epicoon/lx-doc-articles/ru/lx-core/doc/service-config.md).<br>
Какие параметры имеются в конфигурации модуля, можно узнать по [ссылке](https://github.com/epicoon/lx-doc-articles/ru/lx-core/doc/module-config.md).


<a name="js"><h3>Параметры конфигурации: <b>jsBootstrap</b> и <b>jsMain</b></h3></a>
Ключу `jsBootstrap` в конфигурации приложения сопоставляется путь к файлу с JS-кодом, который должен быть выполнен до рендеринга графического интерфейса.<br>
Ключу `jsMain` в конфигурации приложения сопоставляется путь к файлу с JS-кодом, который должен быть выполнен после рендеринга графического интерфейса.<br>
Такой JS-код является глобальным для всего приложения и будет выполняться абсолютно на всех страницах. Поэтому обращаться с ним нужно крайне аккуратно. Использовать только тогда, когда без него действительно не обойтись. Не делать в нем никаких зависимостей от кода сервисов, т.к. это сделает их непереносимыми в другие проекты.


<a name="i18nFile"><h3>Параметр конфигурации: <b>i18nFile</b></h3></a>
Данному ключу в конфигурации приложения сопоставляется путь к карте интернационализации.<br>
[Подробнее о механизме интернационализации](https://github.com/epicoon/lx-doc-articles/ru/lx-core/doc/i18n.md).
