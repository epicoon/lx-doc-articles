[Английская версия (English version)](https://github.com/epicoon/lx-doc-articles/en/lx-core/doc/i18n.md)

## Интернационализация сервиса

Список используемых приложением языков задается в файле `path/to/project/lx/data/languages.php`. Данный файл возвращает ассоциативный массив, где ключи - метки языков, значения - названия (которые также являются метками для интернационализации).

Интернационализация непосредственно осуществляется для сервисов, либо для модулей.

Для осуществления механизма перевода используется карта интернационализации. Карта включает:
* файл с картой интернационализации уровня приложения
* файл с картой интернационализации уровня сервиса
* файл с картой интернационализации уровня модуля (при интернационализации на уровне модуля)
Файл с картой интернационализации (для любого уровня) должен иметь один из форматов: `yaml`, `php` или `json`. По умолчанию файл имеет имя `i18n.(yaml|php|json)` и располагается в корневом каталоге своего уровня.<br>
Путь и имя файла можно задать в файле конфигурации соответствующего уровня (приложения, сервиса, модуля) по ключу `i18nFile`.<br>
Файл должен содержать ассоциативный массив, в котором ключами являются метки используемых приложением языков, значениями - ассоциативные массивы с наборами переводов.

> Совет: если карта большая и ее нужно разбить на несколько файлов, проще всего это сделать в формате `yaml`, используя ссылку на файл: `en-EN: ^ref en-EN.yaml`.

За реализацию алгоритма интернационализации отвечает специальный объект, экземпляр класса `lx\I18nMap` (или унаследованного от него).<br>
При локализации на уровне сервиса, доступен как поле сервиса `$service->i18n`. На уровне модуля - как поле модуля `$module->i18n`.<br>
Данный класс можно изменить в файле конфигурации соответствующего уровня (сервиса или модуля) по ключу `i18nMap`.<br>
Указать информацию о классе можно несколькими способами:
```yaml
# Указание имени класса
i18nMap: ClassName

# Указание ассоциативного массива с именем класса и параметрами для его создания
i18nMap:
  class: ClassName
  param1: value1
  param2: value2

# Указание ассоциативного массива с именем класса
# и параметрами для его создания явно выделенными в отденый массив для наглядности
i18nMap:
  class: ClassName
  params:
    param1: value1
    param2: value2
```

В большинстве случаев, при разработке своих модулей и сервисов, функционала инструмента `lx\I18nMap` вполне достаточно. Но представим ситуацию - используется сторонний сервис `foreign/service`, который не поддерживает интернационализацию на языки, поддерживаемые нашим приложением. Решение - создаем файл с картой интернационализации на нужные нам языки. Чтобы эта карта использовалась сервисом, наследуем класс от `lx\I18nMap`:
```php
// Код PHP

namespace some\nmsp;

use lx\I18nMap;

class Translater extends I18nMap {
	public function mapFiles() {
		return [
			'path/to/map.yaml',
		];
	}
}
```
После чего используем возможность инъекции в конфигурацию сервиса. В конфигурации приложения добавляем:
```yaml
configInjection:
  foreign/service:
    i18nMap: some\nmsp\Translater
```
Все старые карты также будут использоваться, добавится использование новой карты.

Другой способ решения проблемы - если существует пакет, который уже локализует нужный Вам сервис. Устанавливаем его, допустим он называется `foreign/service-i18n`. Устроен он будет по похожему принципу, что указан выше. Допустим, в качестве класса-переводчика он предоставляет `foreignI18n\Translater`. Но что делать, если метки языков не совпадают с Вашими метками? Решение - в конфигурации приложения, совершая инъекцию в конфигурацию сервиса, указываем соответсвия меток:
```yaml
configInjection:
  foreign/service:
    i18nMap:
      class: foreignI18n\Translater
      tags:
      	# ключ - метка переводчика, значение - Ваша метка
        la: la-LA
```
